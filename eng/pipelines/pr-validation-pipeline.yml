name: pr-validation-pipeline

# Trigger the pipeline on merge to main branch
trigger:
  branches:
    include:
      - main

jobs:
- job: TestingMacOS
  pool:
    vmImage: 'macos-latest'

  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.13.5'
      addToPath: true
    displayName: 'Use Python 3.13 on macOS'

  - script: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt
    displayName: 'Install Python dependencies'

  - script: |
      cd mssql_python/pybind
      ./build.sh
    displayName: 'Build pybind bindings (.so)'

  - script: |
      python main.py
    displayName: 'Run main.py to ensure Python is working'
    env:
      # Temporarily Use Azure SQL Database connection string for testing purposes since Docker takes too long to install & start in MacOS
      DB_CONNECTION_STRING: $(AZURE_CONNECTION_STRING)
